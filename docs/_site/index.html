<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" type="text/css" href="/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>mad-spring-connect by </title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>mad-spring-connect</h1>
          <h2>Connecting with a Spring REST APIs in a domain friendly manner</h2>
        </header>
        <section id="downloads" class="clearfix">
          
	  
          <a href="" id="view-on-github" class="button"><span>View on GitHub</span></a>
	    
        </section> 
        <hr>
        <section id="main_content">
          <h1 id="about">About</h1>

<p><a href="https://travis-ci.org/42BV/jarb-final-form"><img src="https://travis-ci.org/42BV/jarb-final-form.svg?branch=master" alt="Build Status" /></a>
<a href="https://codecov.io/gh/42BV/jarb-final-form"><img src="https://codecov.io/gh/42BV/jarb-final-form/branch/master/graph/badge.svg" alt="Codecov" /></a></p>

<p><a href="http://www.jarbframework.org/">JaRB</a> JaRB aims to improve database 
usage in Java enterprise applications. With JaRB you can get the
validation rules from the database into Java. With this project
you can get those rules into your <a href="https://github.com/final-form/react-final-form">react-final-form</a> powered
forms as well.</p>

<h1 id="installation">Installation</h1>

<p><code class="highlighter-rouge">npm install jarb-final-form --save</code></p>

<h1 id="preparation">Preparation</h1>

<p>First in your Java project make sure jarb-final-form can read
the constraints, via a GET request. This is easily done by 
exposing the <code class="highlighter-rouge">BeanConstraintController</code> like so:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">nl</span><span class="o">.</span><span class="na">_42</span><span class="o">.</span><span class="na">seeder</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">nl._42.jarb.constraint.EnableDatabaseConstraints</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">nl._42.jarb.constraint.metadata.BeanConstraintController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">nl._42.jarb.constraint.metadata.BeanConstraintService</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDatabaseConstraints</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">SpringBootServletInitializer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">BeanConstraintController</span> <span class="nf">beanConstraintController</span><span class="o">(</span><span class="n">BeanConstraintService</span> <span class="n">beanConstraintService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BeanConstraintController</span><span class="o">(</span><span class="n">beanConstraintService</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre>
</div>

<h1 id="getting-started">Getting started.</h1>

<p>At the start of your project, in case you are using Create React
App in the index.js, configure the constraints:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">configureConstraint</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'jarb-final-form'</span><span class="p">;</span>

<span class="nx">configureConstraint</span><span class="p">({</span>
   <span class="c1">// The URL which will provide the constraints over a GET request.</span>
  <span class="na">constraintsUrl</span><span class="p">:</span> <span class="s1">'/api/constraints'</span><span class="p">,</span>

  <span class="c1">// Whether or not the 'constraintsUrl' should be called with authentication.</span>
  <span class="na">needsAuthentication</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</code></pre>
</div>

<p>The constraints module must be configured before the application
is rendered.</p>

<p>Finally you will have load the constraints from the back-end using
the <code class="highlighter-rouge">loadConstraints</code> function. If in order for the constraints
to be loaded you need to be logged in, you should load the constraints
as soon as you know that you are logged in:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">loadConstraints</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'jarb-final-form'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">login</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'somewhere'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Login</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">doLogin</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">login</span><span class="p">({</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span> <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">loadConstraints</span><span class="p">);</span> <span class="c1">// Load constraints ASAP</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render here which calls doLogin</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If you do not need a login before you can fetch the constraints
simply fetch them using <code class="highlighter-rouge">loadConstraints</code> as soon as possible.</p>

<h1 id="usage">Usage</h1>

<h2 id="using-jarbfield">Using JarbField</h2>

<p>If you read the documentation of the final-form libary you will know
that you will need the <code class="highlighter-rouge">Field</code> Component to render form elements. This
library simply extends <code class="highlighter-rouge">Field</code> by adding JaRB validation rules to it.</p>

<p>This abstraction is called <code class="highlighter-rouge">JarbField</code>. JarbField wrappes 
final-form’s Field, and adds the auto validation from the 
ConstraintsStore. In fact it is a very thin wrapper around
Field.</p>

<p>It only demands one extra property called ‘jarb’ which is used
to to configure the Field. The ‘jarb’ object needs two keys:
the ‘validator’ and the ‘label’.</p>

<p>The ‘validator’ follows the following format: {Entity}.{Property}. 
For example if the validator property is ‘SuperHero.name’ this means that
the Field will apply the constraints for the ‘name’ property of
the ‘SuperHero’ entity.</p>

<p>The ‘label’ is used to inform you which field was wrong, when errors occur.
You will receive the ‘label’ when an error occurs to create a nice
error message.</p>

<p>For example:</p>

<pre><code class="language-jsx">&lt;JarbField 
  name="Name" 
  jarb={{ validator: 'SuperHero.name', label: "Name" }}
  component="input" 
  type="text"
/&gt;
</code></pre>

<h2 id="displaying-erors">Displaying erors</h2>

<p>Rendering the validation errors is completely up to you.</p>

<p>The way it works is as follows, whenever an error occurs
the <code class="highlighter-rouge">error</code> prop of the Field’s <code class="highlighter-rouge">meta</code> data will contain
an an array of objects.</p>

<p>For example this object could be included in that array:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="c1">// The type of error which occured</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_MINIMUM_LENGTH"</span><span class="p">,</span>
  <span class="c1">// The label of the JarbField</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Description"</span><span class="p">,</span>
  <span class="c1">// The value that the field possesed at the time of the error</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="c1">// The reason why the error occured.</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"minimumLength"</span><span class="err">:</span> <span class="mi">3</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now you could create an Error Component to render the errors:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">ValidationError</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'jarb-final-form'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">Props</span> <span class="p">{</span>
  <span class="nl">meta</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">invalid</span><span class="p">:</span> <span class="kr">boolean</span><span class="p">,</span>
    <span class="nx">error</span><span class="err">:</span> <span class="nx">ValidationError</span><span class="p">,</span>
    <span class="nx">touched</span><span class="err">:</span> <span class="kr">boolean</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">props</span><span class="err">:</span> <span class="nx">Props</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">invalid</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">touched</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">meta</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">invalid</span> <span class="o">&amp;&amp;</span> <span class="nx">touched</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"error"</span><span class="o">&gt;</span><span class="p">{</span> <span class="nx">errorMessage</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">}</span><span class="o">&lt;</span><span class="sr">/span&gt;</span><span class="err">;
</span>    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Render a nice message based on each ValidationType.</span>
<span class="kd">function</span> <span class="nx">errorMessage</span><span class="p">(</span><span class="nx">error</span><span class="err">:</span> <span class="nx">ValidationError</span><span class="p">)</span><span class="err">:</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'ERROR_REQUIRED'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">is</span> <span class="nx">required</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_MINIMUM_LENGTH'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">bigger</span> <span class="nx">than</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">minimumLength</span> <span class="p">}</span> <span class="nx">characters</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_MAXIMUM_LENGTH'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">smaller</span> <span class="nx">than</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">maximumLength</span> <span class="p">}</span> <span class="nx">characters</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_MIN_VALUE'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">more</span> <span class="nx">than</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">minValue</span> <span class="p">}</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_MAX_VALUE'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">less</span> <span class="nx">than</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">maxValue</span> <span class="p">}</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_NUMBER'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">matching</span> <span class="nx">pattern</span><span class="err">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">regex</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">'ERROR_NUMBER_FRACTION'</span><span class="err">:</span>
      <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">error</span><span class="p">.</span><span class="nx">label</span> <span class="p">}</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">machthing</span> <span class="nx">pattern</span><span class="err">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">reasons</span><span class="p">.</span><span class="nx">regex</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
     <span class="k">return</span> <span class="s1">'UNKNOWN_ERROR'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Here are examples of all errors which can occur:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_REQUIRED"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Name"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"required"</span><span class="err">:</span> <span class="s2">"required"</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_MINIMUM_LENGTH"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Description"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">''</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"minimumLength"</span><span class="err">:</span> <span class="mi">3</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_MAXIMUM_LENGTH"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Info"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">'aaaa'</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"maximumLength"</span><span class="err">:</span> <span class="mi">3</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_MIN_VALUE"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Age"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"minValue"</span><span class="err">:</span> <span class="mi">15</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_MAX_VALUE"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Amount"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="mi">16</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"maxValue"</span><span class="err">:</span> <span class="mi">15</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"ERROR_NUMBER"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Telephone"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">'noot'</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"regex"</span><span class="err">:</span> <span class="o">/^-</span><span class="p">?</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="nx">$</span><span class="o">/</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"ERROR_NUMBER_FRACTION"</span><span class="p">,</span>
  <span class="s2">"label"</span><span class="err">:</span> <span class="s2">"Telephone"</span><span class="p">,</span>
  <span class="s2">"value"</span><span class="err">:</span> <span class="s1">'noot'</span><span class="p">,</span>
  <span class="s2">"reasons"</span><span class="err">:</span> <span class="p">{</span> <span class="s2">"regex"</span><span class="err">:</span> <span class="o">/^-</span><span class="p">?</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="nx">$</span><span class="o">/</span><span class="p">,</span> <span class="s2">"fractionLength"</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

        </section>

        <footer>
        
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

    
  </body>
</html>
